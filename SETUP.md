# Setup Guide

## Automated Setup Flow

This project includes an automated setup system that makes it easy to get started with local development.

## For New Developers

### Prerequisites

Install pnpm if you don't have it:

```bash
npm install -g pnpm
```

Or using Homebrew (macOS):
```bash
brew install pnpm
```

Or enable corepack (Node.js 16.13+):
```bash
corepack enable
```

### Quick Start (3 Commands)

```bash
git clone <repo-url>
cd school-newspaper
pnpm install        # ← Automatically sets up everything!
pnpm run dev        # ← Start coding immediately
```

Open http://localhost:3000 and you're ready to go!

**Default admin credentials:**
- Password: `admin123` (change this in `.env.local`)

---

## What Happens During `pnpm install`?

The `postinstall` script runs automatically and:

1. **Creates `data/` directory**
   - Used for local posts storage (development mode)
   - Automatically created if missing

2. **Generates `.env.local`** (if it doesn't exist)
   - Copies from `.env.example`
   - Generates secure random JWT secret (32 bytes, base64)
   - Sets default values:
     - `ADMIN_PASSWORD=admin123` ⚠️ Change this!
     - `JWT_SECRET=<auto-generated>`
     - `NEXT_PUBLIC_SITE_URL=http://localhost:3000`
     - `SESSION_DURATION=604800` (7 days)

3. **Shows next steps**
   - Reminds you to run `pnpm run setup` for database
   - Or start developing with `pnpm run dev`

**Skipped in CI/CD:** The postinstall script automatically skips in CI environments (Vercel, GitHub Actions).

---

## Interactive Setup (Optional)

For full features with PostgreSQL and multi-user authentication:

```bash
pnpm run setup
```

### What This Does

**Interactive prompts:**
1. **Admin password** - Custom password (or keep default `admin123`)
2. **Database configuration** - If PostgreSQL is detected:
   - Host (default: `localhost`)
   - Port (default: `5432`)
   - Username (default: `postgres`)
   - Password
   - Database name (default: `school_newspaper`)

**Automated steps:**
- Detects PostgreSQL installation (macOS, Linux, Windows)
- Generates PostgreSQL connection string
- Updates `.env.local` with database credentials
- Runs `pnpm run db:init` to create schema
- Shows next steps

### After Setup

Create your first user account:
```bash
pnpm run create-admin
```

Start development:
```bash
pnpm run dev
```

---

## Setup Modes

### Mode 1: Minimal Setup (Default)
**When:** `pnpm install` only
**Features:**
- Posts stored in `data/posts.json` (local file)
- No user authentication
- Admin-only mode (password-protected)
- Perfect for quick testing or simple use cases

### Mode 2: Full Setup
**When:** `pnpm install` + `pnpm run setup`
**Features:**
- Posts stored in `data/posts.json` (local)
- Users stored in PostgreSQL database
- Multi-user authentication with JWT
- User registration and login
- Role-based access control
- Admin panel with user management

---

## Manual Setup (Alternative)

If you prefer manual configuration:

### 1. Copy Environment Template
```bash
cp .env.example .env.local
```

### 2. Generate JWT Secret
```bash
openssl rand -base64 32
```

Copy the output and paste into `.env.local`:
```bash
JWT_SECRET=<paste-here>
```

### 3. Set Admin Password
```bash
ADMIN_PASSWORD=your_secure_password_here
```

### 4. Configure Database (Optional)
```bash
POSTGRES_URL=postgresql://user:password@localhost:5432/dbname
```

### 5. Initialize Database
```bash
pnpm run db:init
pnpm run create-admin
```

---

## Troubleshooting

### "Cannot find module" errors
```bash
# Reinstall dependencies
rm -rf node_modules pnpm-lock.yaml
pnpm install
```

### Database connection errors
```bash
# Check database is running
psql -h localhost -U postgres

# Reinitialize database
pnpm run db:init
```

### Environment variable errors
```bash
# Regenerate .env.local
rm .env.local
pnpm run setup
```

### Port 3000 already in use
```bash
# Kill process using port 3000
lsof -ti:3000 | xargs kill -9

# Or use different port
PORT=3001 pnpm run dev
```

---

## Scripts Reference

| Script | Description | Interactive? |
|--------|-------------|--------------|
| `pnpm install` | Install deps + auto setup | No |
| `pnpm run setup` | Full interactive setup | Yes |
| `pnpm run setup:db` | Legacy Arch Linux setup | Yes |
| `pnpm run dev` | Start dev server | No |
| `pnpm run db:init` | Initialize database schema | No |
| `pnpm run create-admin` | Create admin user | Yes |

---

## Environment Variables

### Required
- `ADMIN_PASSWORD` - Admin panel password (min 8 chars)
- `JWT_SECRET` - JWT signing key (min 32 chars)
- `NEXT_PUBLIC_SITE_URL` - Site URL (e.g., http://localhost:3000)

### Optional
- `POSTGRES_URL` - Database connection string (enables user auth)
- `SESSION_DURATION` - JWT session duration in seconds (default: 604800 = 7 days)

### Auto-configured by Vercel
- `BLOB_READ_WRITE_TOKEN` - Vercel Blob storage token
- `POSTGRES_URL_NON_POOLING` - Non-pooled database connection

---

## Next Steps

After setup:

1. **Start development server**
   ```bash
   pnpm run dev
   ```

2. **Access the site**
   - Homepage: http://localhost:3000
   - Admin panel: http://localhost:3000/admin

3. **Create content**
   - Login to admin panel
   - Create your first blog post
   - View it on the homepage

4. **Deploy to Vercel** (when ready)
   - See [DEPLOYMENT.md](DEPLOYMENT.md) for details
   - Run `pnpm run pre-deploy` first

---

## Security Notes

⚠️ **Important:** Change the default admin password!

1. Open `.env.local`
2. Change `ADMIN_PASSWORD=admin123` to a strong password
3. Restart the dev server

For production deployment, always use:
- Strong admin password (12+ characters)
- Secure JWT secret (generated via `openssl rand -base64 32`)
- HTTPS only (handled by Vercel)

---

**Need help?** See [CLAUDE.md](CLAUDE.md) for technical documentation.
